This is frankencode pieced together and is in desperate need of comments lol, sorry
